magic_castle::site::tags:
  haproxy:
    - haproxy
  edx:
    - tutor
    - cron
    - restic

profile::reverse_proxy::subdomains:
  edx: "http://edx1.int.%{lookup('terraform.data.domain_name')}"
  preview.edx: "http://edx1.int.%{lookup('terraform.data.domain_name')}"
  studio.edx: "http://edx1.int.%{lookup('terraform.data.domain_name')}"
  apps.edx: "http://edx1.int.%{lookup('terraform.data.domain_name')}"
  jupyter: "https://127.0.0.1:8000"
profile::reverse_proxy::main2sub_redir: "edx"

tutor::admin_email: "noreply@calculquebec.ca"
tutor::admin_password: "%{alias('edx_admin_password')}"

tutor::config:
  - ["LANGUAGE_CODE", "fr"]
  - ["PLATFORM_NAME", "EdX Calcul Qu√©bec"]
  - ["CONTACT_EMAIL", "noreply@calculquebec.ca"]
  - ["LMS_HOST", "edx.%{lookup('terraform.data.domain_name')}"]
  - ["CMS_HOST", "studio.edx.%{lookup('terraform.data.domain_name')}"]
  - ["PREVIEW_LMS_HOST", "preview.edx.%{lookup('terraform.data.domain_name')}"]
  - ["ENABLE_WEB_PROXY", "false"]
  - ["CADDY_HTTP_PORT", "0.0.0.0:80"]
  - ["ENABLE_HTTPS", "true"]

cron::job:
  backup:
    command: 'tutor local backup'
    minute: '0'
    hour: '1'
    date: '*'
    month: '*'
    weekday: '*'
    user: tutor
    description: 'Take a backup of EdX'
  clear_backup:
    command: 'find /tutor/.local/share/tutor/env/backup/ -type f -mtime +30 -delete'
    minute: '0'
    hour: '1'
    date: '*'
    month: '*'
    weekday: '*'
    user: root
    description: 'Delete backups older than 30 days'


restic::repositories:
  backup_edx_repo:
    enable_backup: true
    id: "${alias('s3_id')}"
    key: "${alias('s3_key')}"
    password: "${alias('s3_password')}"
    host: "object-arbutus.cloud.computecanada.ca"
    bucket: "backup_edx/backup_1"
    backup_path:
      - /tutor/.local/share/tutor/env/backup/
    backup_timer: Mon..Sun 2:00:00
#    enable_forget: true
#    forget_timer: Mon..Sun 3:00:00

